<app-layout>
  <div class="dashboard-container">
    
    <!-- User Form Card -->
    <p-card [header]="isEditMode ? 'Edit User' : 'Create User'" styleClass="mb-4">
      <div class="form-grid">
        <div class="field">
          <label for="userName">User Name</label>
          <input 
            pInputText 
            id="userName" 
            [(ngModel)]="selectedUser.userName" 
            placeholder="Enter user name"
            class="w-full" />
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input 
            pInputText 
            id="email" 
            type="email"
            [(ngModel)]="selectedUser.email" 
            placeholder="Enter email"
            class="w-full" />
        </div>

        <div class="field">
          <label for="role">Role</label>
          <p-select 
            id="role"
            [(ngModel)]="selectedUser.role" 
            [options]="roleOptions" 
            optionLabel="label" 
            optionValue="value"
            placeholder="Select a role"
            class="w-full">
          </p-select>
        </div>

        <div class="field flex gap-2 align-items-end">
          <p-button 
            [label]="isEditMode ? 'Update' : 'Create'" 
            icon="pi pi-check"
            (onClick)="saveUser()"
            severity="success">
          </p-button>

          <p-button 
            *ngIf="isEditMode"
            label="Cancel" 
            icon="pi pi-times"
            (onClick)="resetForm()"
            severity="secondary">
          </p-button>
        </div>
      </div>
    </p-card>

    <!-- Users Table Card -->
    <p-card header="All Users">
      <p-table 
        [value]="(users$ | async) || []" 
        [paginator]="true" 
        [rows]="10"
        [tableStyle]="{ 'min-width': '50rem' }"
        [rowsPerPageOptions]="[5, 10, 20]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} users"
        styleClass="p-datatable-striped">
        
        <ng-template #header>
          <tr>
            <th pSortableColumn="id">ID <p-sortIcon field="id" /></th>
            <th pSortableColumn="userName">User Name <p-sortIcon field="userName" /></th>
            <th pSortableColumn="email">Email <p-sortIcon field="email" /></th>
            <th pSortableColumn="role">Role <p-sortIcon field="role" /></th>
            <th style="width: 200px">Actions</th>
          </tr>
        </ng-template>
        
        <ng-template #body let-user>
          <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.userName }}</td>
            <td>{{ user.email }}</td>
            <td>
              <span [class]="'badge ' + (user.role === 'Admin' ? 'badge-admin' : 'badge-user')">
                {{ user.role }}
              </span>
            </td>
            <td>
              <div class="flex gap-2">
                <p-button 
                  icon="pi pi-pencil"
                          label="Edit"
                  [rounded]="true"
                  severity="info"
                  size="small"
                  (onClick)="editUser(user)"
                  [text]="true">
                </p-button>
                <p-button 
                  icon="pi pi-trash"
                          label="Delete"
                  [rounded]="true"
                  severity="danger"
                  size="small"
                  (onClick)="deleteUser(user.id!)"
                  [text]="true">
                </p-button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template #emptymessage>
          <tr>
            <td colspan="5" class="text-center">No users found.</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>

    <!-- Confirmation Dialog -->
    <p-confirmDialog />

  </div>
</app-layout>
